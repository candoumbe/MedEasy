@using MedEasy.Controllers;
@using MedEasy.RestObjects;
@using MedEasy.ViewModels.Patient;


@{
    ViewData["Title"] = "Ma patientèle";
    IKendoDataSource dataSource = new KendoRemoteDataSource
    {
        Page = 1,
        PageSize = 5,
        Transport = new KendoTransport
        {
            Read = new KendoTransportOperation
            {
                Cache = false,
                Url = Url.Action(nameof(PatientsController.GetAll), PatientsController.ControllerName),
                Type = "GET"
            }
        },
        DataSchema = new KendoSchema
        {
            Model = new KendoModel
            {
                Id = nameof(PatientListModel.Id),
                Fields = new KendoFieldBase[]
                {
                        new KendoStringField(nameof(PatientListModel.Firstname)) { DefaultValue = string.Empty,  Editable=true, Nullable= true},
                        new KendoStringField(nameof(PatientListModel.Lastname)) { DefaultValue = string.Empty, Editable=true, Nullable= true},
                        new KendoDateField(nameof(PatientListModel.BirthDate)) { Editable=true, Nullable= false },
                        new KendoStringField(nameof(PatientListModel.BirthPlace)) { DefaultValue = string.Empty, Editable=true}
                }
            },
            Data = nameof(GenericPagedGetResponse<PatientListModel>.Items),
            Total = nameof(GenericPagedGetResponse<PatientListModel>.Count),
        }

    };

    IEnumerable<KendoGridColumnBase> columns = new KendoGridColumnBase[]
    {
        new KendoGridFieldColumn() {
            Title = "Fullname" ,
            Columns = new [] {
                new KendoGridFieldColumn { Field = nameof(PatientListModel.Firstname) },
                new KendoGridFieldColumn { Field = nameof(PatientListModel.Lastname) }
            }
        },
        new KendoGridFieldColumn() { Field = nameof(PatientListModel.BirthDate), Format = "{0:dd/MM/yyyy}" },
        new KendoGridFieldColumn() { Field = nameof(PatientListModel.BirthPlace) },
        new KendoGridTemplateColumn { Template = $"<a class='btn btn-success btn-sm'>" +
                                                    "<span class='glyphicon glyphicon-pencil' aria-hidden='true'></span> <span class='visible-md-inline visible-lg-inline'>Modifier</span>" +
                                                "</a>"
        }
    };

    PageableConfiguration pageable = new PageableConfiguration
    {
        PageSizes = true,
        Refresh = true,
        PreviousNext = true
    };
}

<h2>@ViewData["Title"]</h2>


<div class="container-fluid">
    <div class="row">
        <a class="btn btn-primary" href="@Url.Action(nameof(PatientController.Create))">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Nouvelle fiche patient
        </a>
    </div>
    <div class="row">
        <kendo-grid id="tbl-patients"
                    asp-data-columns="columns"
                    asp-data-source="dataSource"
                    asp-data-pageable="pageable"
                    data-filterable="true"
                    asp-data-reorderable="true"
                    style="height:320px" />
    </div> 
</div>




    
    
