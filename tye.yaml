# tye application configuration file
# read all about it at https://github.com/dotnet/tye
#
# when you've given us a try, we'd love to know what you think:
#    https://aka.ms/AA7q20u
#
name: medeasy
extensions:
- name: zipkin

ingress:
  - name: ingress
    tags:
      - proxies
    bindings:
      - port: 8080
        protocol: https
    rules:
      - path: /api/identity
        service: identity
      - path: /api/measures
        service: measures
      - path: /api/documents
        service: documents
      - path: /api/agenda
        service: agenda
      - path: /api/patients
        service: patients
      - service: web
  
services:
- name: web
  project: src/clients/web/MedEasy/Medeasy.csproj
  tags:
  - frontends
  - web
- name: identity-api
  project: src/services/identity/Identity.API/Identity.API.csproj
  tags:
  - backends
  - identity
- name: measures-api
  project: src/services/Measures/Measures.API/Measures.API.csproj
  tags:
  - backends
  - measures
- name: patients-api
  project: src/services/Patients/Patients.API/Patients.API.csproj
  tags:
  - backends
  - patients
- name: agenda-api
  project: src/services/agenda/Agenda.API/Agenda.API.csproj
  tags:
  - backends
  - agenda
- name: documents-api
  project: src/services/document/Documents.API/Documents.API.csproj
  tags:
  - backends
  - documents
- name: identity
  image: postgres:12-alpine
  env:
  - POSTGRES_PASSWORD="pass@word1"
  - POSTGRES_USER="identity_api"
  - POSTGRES_DB="identity"
  bindings:
    - containerPort: 5432
      connectionString: Server=${host};Port=${port};Database=${env:POSTGRES_DB};User ID=${env:POSTGRES_USER};Password=${env:POSTGRES_PASSWORD};
  tags:
  - backends
  - identity
  - databases
- name: measures
  image: postgres:12-alpine
  env:
  - POSTGRES_PASSWORD="pass@word1"
  - POSTGRES_USER="measures_api"
  - POSTGRES_DB="measures"
  bindings:
    - containerPort: 5432
      connectionString: Server=${host};Port=${port};Database=${env:POSTGRES_DB};User ID=${env:POSTGRES_USER};Password=${env:POSTGRES_PASSWORD};
  tags:
  - backends
  - measures
  - databases
- name: documents
  image: postgres:12-alpine
  env:
  - POSTGRES_PASSWORD="pass@word1"
  - POSTGRES_USER="documents_api"
  - POSTGRES_DB="documents"
  bindings:
    - containerPort: 5432
      connectionString: Server=${host};Port=${port};Database=${env:POSTGRES_DB};User ID=${env:POSTGRES_USER};Password=${env:POSTGRES_PASSWORD};
  tags:
  - backends
  - documents
  - databases
- name: patients
  image: postgres:12-alpine
  env:
  - POSTGRES_PASSWORD="pass@word1"
  - POSTGRES_USER="patients_api"
  - POSTGRES_DB="patients"
  bindings:
    - containerPort: 5432
      connectionString: Server=${host};Port=${port};Database=${env:POSTGRES_DB};User ID=${env:POSTGRES_USER};Password=${env:POSTGRES_PASSWORD};
  tags:
  - backends
  - patients
  - databases
- name: agenda
  image: postgres:12-alpine
  env:
  - POSTGRES_PASSWORD="pass@word1"
  - POSTGRES_USER="agenda_api"
  - POSTGRES_DB="agenda"
  bindings:
    - containerPort: 5432
      connectionString: Server=${host};Port=${port};Database=${env:POSTGRES_DB};User ID=${env:POSTGRES_USER};Password=${env:POSTGRES_PASSWORD};
  tags:
  - backends
  - agenda
  - databases
- name: seq
  image: datalust/seq
  env:
    - name: "ACCEPT_EULA"
      value: "Y"
  bindings:
    - name: ui
      port: 55340
      protocol: http
      containerPort: 80
    - name: internal
      containerPort: 5341
      port : 55341
  tags:
  - backends
  - agenda
  - documents
  - identity
  - patients
  - measures
- name: message-bus
  image: masstransit/rabbitmq:3.8
  bindings:
    - name: internal
      containerPort : 5672
      protocol: rabbitmq
    - name: ui
      containerPort: 15672
      protocol: http
  tags:
    - backends
    - agenda
    - documents
    - identity
    - measures
    - patients
    - esb
- name: zipkin
  image: openzipkin/zipkin
  bindings:
    - port: 59411
      containerPort: 9411
      protocol: http
