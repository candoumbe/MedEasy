version: '3.7'

services:

  eventstore:
    image: eventstore/eventstore:release-4.1.2
    ports:
      - "7000:1113"
      - "7001:2113"
  identity.db:
    image: microsoft/mssql-server-linux:2017-CU12
    environment:
      ACCEPT_EULA: Y
      TZ: Europe/Brussels
  patients.db:
    image: microsoft/mssql-server-linux:2017-CU12
    environment:
      ACCEPT_EULA: Y
      TZ: Europe/Brussels
 
  measures.db:
    image: microsoft/mssql-server-linux:2017-CU12
    environment:
      ACCEPT_EULA: Y
      TZ: Europe/Brussels
  
  documents.db:
    image: microsoft/mssql-server-linux:2017-CU12
    environment:
      ACCEPT_EULA: Y
      TZ: Europe/Brussels


  identity.api:
    image: ${DOCKER_REGISTRY-}identityapi
    build:
      context: .
      dockerfile: src/services/identity/Identity.API/Dockerfile
    depends_on:
      - identity.db
      - eventstore

  patients.api:
    image: ${DOCKER_REGISTRY-}patientsapi
    build:
      context: .
      dockerfile: src/services/patients/Patients.API/Dockerfile
    depends_on:
      - identity.api
      - patients.db
      - eventstore

  measures.api:
    image: ${DOCKER_REGISTRY-}measuresapi
    build:
      context: .
      dockerfile: src/services/measures/Measures.API/Dockerfile
    depends_on:
      - identity.api
      - measures.db
      - eventstore
      
  documents.api:
    image: ${DOCKER_REGISTRY-}documentsapi
    build:
      context: .
      dockerfile: src/services/document/Documents.API/Dockerfile
    depends_on:
      - identity.api
      - documents.db
      - eventstore

  medeasy.web:
    image: ${DOCKER_REGISTRY}medeasyweb
    build:
      context: .
      dockerfile: src/clients/web/MedEasy.Web/Dockerfile
    depends_on:
      - identity.api
      - patients.api
    ports:
      - "5000:80"
      - "5001:443"